\input{dofirst}
\documentclass{standalone}
%\usepackage{tabularray}
\input{preamble}
\input{tikzpacket-newer-sa-da}
\input{tikznetwork}

\begin{document}%
    \begin{tikzpicture}

    \usetikzlibrary{math,calc}
    \node[align=left, opacity=0, anchor=south west] at (0,-1cm) (sample) {DA:~\texttt{fc00:0:2:e003:})};
    \tikzmath{
        coordinate \wNode;
        \wNode1=(sample.east) - (sample.west);
        \n1= {veclen(\wNodex1,\wNodey1) - \pgflinewidth};
        \wNode2=(sample.north) - (sample.south);
        \n2= {veclen(\wNodex2,\wNodey2) - \pgflinewidth};
    }
    \def\pktwidth{\n1}
    \def\pktheight{\n2}

    \tikzset{artr/.style={router}}
    \tikzset{abigrtr/.style={router, scale=1.5, semithick}} % thin (0.4pt) at scale 1.5 is semithick (0.6pt)
    \tikzset{albl/.style={font=\Large}}
    \tikzstyle{uAarrow}=[>={Straight Barb[width=12pt,length=8pt]}]
    \tikzstyle{uAarrow}=[>={Straight Barb[width=12pt,length=8pt]}]

        \node[abigrtr](2){2};
        
        \node[below=.1cm of 2, albl] (label) {End.X with PSP};

        \node[below=0.1cm of label](2b){};
        \node[anchor=east, minimum width=1cm] at (2b-|2.west)(2bl){};
        \node[anchor=west, minimum width=1cm] at (2b-|2.east)(2br){};

        % pkt1
        \node[left=.2cm of 2bl.west, anchor=north east] (pkt1){%
            \begin{srv6packetnew}[\pktwidth pt]%
                \ipsixhdrnew{\texttt{fc00:0:1::1}}{\texttt{fc00:0:2:e003::}}%
                \srhdrnew{(\texttt{fc00:0:4::}, \\\phantom{(}\texttt{fc00:0:2:e003::})}%
                {1}%
            \end{srv6packetnew}%
        };

        % pkt2
        \node[right=.2cm of 2br.east, anchor=south west] at (2br.east|-pkt1.south) (pkt2){%
            \begin{srv6packetnew}[\pktwidth pt]%
                \ipsixhdrnew{\texttt{fc00:0:1::1}}{\texttt{\underline{fc00:0:4::}}}%
            \end{srv6packetnew}%
        };

        \node[anchor=east, minimum width=1cm] at (pkt2-|2.west)(2bl){};
        \node[anchor=west, minimum width=1cm] at (pkt2-|2.east)(2br){};

        \draw[bigarrow] (2bl.west) -- (2bl.east);
        \draw[bigarrow] (2br.west) -- (2br.east);

    \node[artr, anchor=west] at (2-|pkt1.west) (1) {1};
    \node[artr, anchor=east] at (2-|pkt2.east) (4) {4};
    \node[artr] at ($(2)!0.8!(4)$) (3) {3};
    
    \draw[connec, dashed] (1) -- (2);
    \draw[connec, dashed] (2) -- (3);
    \draw[connec, dashed] (3) -- (4);

    \draw[connec, double, ultra thick, ->, uAarrow] (2) -- (3);

    \pgfsize{\mywidth}{\myheight}
\end{tikzpicture}
\typeout{W=\the\mywidth}
\typeout{H=\the\myheight}
\end{document}



